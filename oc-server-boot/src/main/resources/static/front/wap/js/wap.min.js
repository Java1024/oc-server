function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l={showDialog:function(a){!function(){var e='<div id="p_dialog_header"><div id="p_dialog_header_name">'+(a=$.extend({title:"提示",content:"提示框"},a)).title+'</div><div id="p_dialog_close"></div></div>',t='<div id="p_dialog_content">'+a.content+"</div>";$("#p_dialog_mask_wrapper").remove();var n='<div id="p_dialog_mask_wrapper"><div id="p_dialog_container">'+e+t+'<div id="p_dialog_opts"><span id="p_dialog_submit">关闭</span></div></div>';$("body").append(n),$("#p_dialog_mask_wrapper").on("click",function(){$("#p_dialog_mask_wrapper").remove()}),$("#p_dialog_close").on("click",function(){$("#p_dialog_mask_wrapper").remove()}),$("#p_dialog_container").on("click",function(e){m.stopPropagation(e)}),$("#p_dialog_submit").on("click",function(){$("#p_dialog_mask_wrapper").remove()})}()}},p={filterHtmlJsSpaceEnter:function(e){return e&&0<e.length&&(e=(e=e.replace(/[\s| | ]*\r/gi," ")).replace(/<(?!br([/]*)>)[^>]*>/gi,"")),e},htmlEncodeByRegExp:function(e){return 0==e.length?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g," ").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},htmlDecodeByRegExp:function(e){return 0==e.length?"":e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&#39;/g,"'").replace(/&quot;/g,'"')},htmlTurnCharacter:function(e){if(0==e.length)return"";return e.replace(/(.*?)<img.*?alt="(.*?)">/gi,"$1$2")}};function e(){$("[contenteditable]").each(function(){try{document.execCommand("AutoUrlDetect",!1,!1)}catch(e){}$(this).on("paste",function(e){e.preventDefault();var t,n,a=null;if(!(a=window.clipboardData&&clipboardData.setData?window.clipboardData.getData("text"):(e.originalEvent||e).clipboardData.getData("text/plain")))return!1;document.body.createTextRange?(console.log("insert Text"),document.selection?textRange=document.selection.createRange():window.getSelection&&(sel=window.getSelection(),t=sel.getRangeAt(0),(n=document.createElement("span")).innerHTML="&#FEFF;",t.deleteContents(),t.insertNode(n),textRange=document.body.createTextRange(),textRange.moveToElementText(n),n.parentNode.removeChild(n)),textRange.text=a,textRange.collapse(!1),textRange.select()):document.execCommand("insertText",!1,a)}),$(this).on("keydown",function(e){if(e.ctrlKey||e.metaKey)switch(e.keyCode){case 66:case 98:case 73:case 105:case 85:case 117:e.preventDefault()}})})}var t={domain:"jshii.com.cn",ws:"ws://im.jshii.com.cn:6066",poll:"http://im.jshii.com.cn:6066",api:"http://im.jshii.com.cn:8080"},a=t.api,s={auth:a+"/customer/auth",opinion:a+"/opinion/rate",chatRecord:a+"/chat/before",hot:a+"/hot/question",uploadImage:a+"/upload/image",uploadImgb64:a+"/upload/imgb64",goodsDetail:a+"/goods/info",recommendList:a+"/recommend/list",orderList:a+"/order/list",logistics:a+"/order/logistics"},o={get:function(e,t,n,a,i){t.t=(new Date).getTime(),$.ajax({type:"GET",url:e,data:t,dataType:"json",async:n,xhrFields:{withCredentials:!0},success:function(e){a&&a instanceof Function&&a(e)},error:function(e){i&&i instanceof Function&&i(e)}})},post:function(e,t,n,a,i){t.t=(new Date).getTime(),$.ajax({type:"POST",url:e,data:t,dataType:"json",async:n,xhrFields:{withCredentials:!0},success:function(e){a&&a instanceof Function&&a(e)},error:function(e){i&&i instanceof Function&&i(e)}})},jsonp:function(e,t,n,a,i){t.t=(new Date).getTime(),$.ajax({type:"POST",url:e,data:t,dataType:"jsonp",async:n,jsonp:"callback",xhrFields:{withCredentials:!0},success:function(e){a&&a instanceof Function&&a(e)},error:function(e){i&&i instanceof Function&&i(e)}})},uploadImg:function(e,t,n,a,i){$.ajax({url:e,data:t,dataType:"json",type:"POST",async:n,processData:!1,contentType:!1,xhrFields:{withCredentials:!0},success:function(){a&&a instanceof Function&&a()},error:function(){i&&i instanceof Function&&i()}})}},u={build_success:"会话创建成功！",waitting_tip:"当前客服繁忙，已加入等候队列（您前面还有 {0} 个人）请您耐心等候...",service_info:"客服工号 {0} 为您提供服务~",close_tip:"会话已结束（回复再次咨询）."},i=1e3,m={getCookie:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):"oc-"+(65536*(1+Math.random())|0).toString(16).substring(1)},getPid:function(){return i+++"-"+c()+"-"+c()+"-"+c()+"-"+c()+"-"+c()+c()+c()},dateFormat:function(e){var t=e&&e instanceof Date?e:new Date,n=t.getFullYear(),a=t.getMonth()+1,i=t.getDate();return n+"-"+(a<10?"0"+a:a)+"-"+(i<10?"0"+i:i)+" "+t.toTimeString().substr(0,8)},getUrlParams:function(){var e=decodeURI(location.search);if(1==e.indexOf("?"))return null;for(var t,n=(e=e.substr(1)).split("&"),a={},i=0;i<n.length;i++)a[(t=n[i].split("="))[0]]=t[1];return a},isMobile:function(){var e=navigator.userAgent;return!!e.match(/AppleWebKit.*Mobile.*/)||!!e.match(/AppleWebKit/)&&e.indexOf("QIHU")&&-1<e.indexOf("QIHU")&&e.indexOf("Chrome")<0},uploadImg:function(e,n){var t='<form id="submit_upload_img" method="post" action="'+e+'" enctype="multipart/form-data" target="iframe_upload_img" style="display: none"><input type="file" id="input_upload_img" name="file" accept=".jpg,.gif,.jpeg,.png" /></form>';$("#iframe_upload_img").remove(),$("#submit_upload_img").remove(),$("body").append('<iframe id="iframe_upload_img" name="iframe_upload_img" style="display: none"></iframe>'),$("body").append(t),$("#input_upload_img").change(function(){$("#submit_upload_img").submit()}),$("#iframe_upload_img").load(function(e){var t=$("#iframe_upload_img")[0].contentWindow.document.querySelector("body").innerHTML,t=JSON.parse(t);n&&n instanceof Function&&n(t)}),$("#input_upload_img").click()},uploadImgB64:function(e,t,n){var a='<form id="submit_upload_img" method="post" action="'+e+'" enctype="multipart/form-data" target="iframe_upload_img" style="display: none"><input id="input_upload_img" name="imgb64" value="'+t+'" accept=".jpg,.gif,.jpeg,.png" /></form>';$("#iframe_upload_img").remove(),$("#submit_upload_img").remove(),$("body").append('<iframe id="iframe_upload_img" name="iframe_upload_img" style="display: none"></iframe>'),$("body").append(a),$("#iframe_upload_img").load(function(e){var t=$("#iframe_upload_img")[0].contentWindow.document.querySelector("body").innerHTML,t=JSON.parse(t);n&&n instanceof Function&&n(t)}),$("#submit_upload_img").submit()},createImgHtml:function(e){return'<img src="'+e+'" style="max-width: 100%; max-height: 300px;" onload="conFitScroll()" />'},stopPropagation:function(e){window.showModalDialog?window.event.cancelBubble=!0:e.stopPropagation()}};function c(){return Math.floor(65535*(1+Math.random())).toString(16).substring(1)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":n(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.iNotify=t()}(window,function(){function e(e){this.init(e||{})}var n=document.title;return e.prototype.init=function(e){this.open=!1,this.effect=e.effect||"flash",this.message=e.message||"有新消息了!",this.title=document.title||this.message,this.interval=e.interval||500,this.onceTime=e.onceTime||2e3,this.isActiveW=!1,this.onMonitor()},e.prototype.start=function(){var e=this;if(e.stop(),"flash"===e.effect){var t=!1;return e.flashInterval=setInterval(function(){document.title=t?n:e.message,t=!t},e.interval)}if("scroll"===e.effect)return document.title=e.message,e.scrollInterval=setInterval(function(){var e=document.title;document.title=e.substring(1,e.length)+e.substring(0,1),e=document.title.substring(0,e.length)},e.interval)},e.prototype.stop=function(){var e=this;return e.isActiveW=!1,clearTimeout(e.onceTimeout),"flash"===e.effect?(e.flashInterval&&clearInterval(e.flashInterval),document.title=n):"scroll"===e.effect?(e.scrollInterval&&clearInterval(e.scrollInterval),document.title=n):void 0},e.prototype.once=function(){var e=this;if(e.stop(),"flash"===e.effect||"scroll"===e.effect)return clearTimeout(e.onceTimeout),e.start(),e.onceTimeout=setTimeout(function(){e.stop()},e.onceTime)},e.prototype.onMonitor=function(){var e=this;window.onfocus=function(){e.isActiveW||(e.isActiveW=!0,e.stop())},document.onclick=function(){e.isActiveW||(e.isActiveW=!0,e.stop())}},e});var r=new iNotify({effect:"scroll",message:"您有新消息..."}),f={type:{inMessage:"inMessage",outMessage:"outMessage",broadcast:"broadcast"},render:function(e,t){switch(e){case this.type.inMessage:g(t);break;case this.type.outMessage:v(t);break;case this.type.broadcast:h(t)}},renderHistory:function(e){y(e)},renderBroadcast:function(e){$("#chat_service_status_msg").text(e)},renderHtml:function(e){E(e)},toScroll:function(){j()}},d="客服撤回一条消息";function g(e){var t=e.type;switch(t){case"BUILD_CHAT":te.cid=e.cid,g.buildChat(e);break;case"MESSAGE":g.message(e);break;case"TRANSFER":g.transfer(e);break;case"BROADCAST":g.broadcast(e);break;case"CLOSE_CHAT":h(u.close_tip);break;case"REVOCATION":b(e);break;case"EVALUATE":$("#option_box").show()}r.open&&"PONG"!==t&&r.start()}function v(e){var t;switch(e.type){case"TEXT":t='<div class="user-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>我</b></div><div class="chat-body">'+O(W.face.toEmoji(e.content))+"</div></div></div>";break;case"IMAGE":t='<div class="user-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>我</b></div><div class="chat-body">'+W.face.toEmoji(e.content)+"</div></div></div>";break;case"ORDER":t='<div class="user-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>我</b></div><div class="chat-body">'+I(e.content)+"</div></div></div>"}S(e,t)}function h(e){$("#chat_service_status_msg").text(e)}function b(e){var t=e.pid;$("div[pid="+t+"]").html("<div class='revocation'>"+d+"</div>")}function y(e){if(e){var t,n=w(e);switch(e.ownerType){case"1":t='<div class="user-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.createTime+'</span><b>我</b></div><div class="chat-body">'+n+"</div></div></div>";break;case"2":t='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.createTime+"</span><b>"+e.briefName+'</b><b class="left-space">'+e.waiterCode+'</b></div><div class="chat-body">'+n+"</div></div></div>";break;default:t="5"==e.messageType||"9"==e.messageType?'<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.createTime+"</span><b>"+e.briefName+'</b><b class="left-space">'+e.waiterCode+'</b></div><div class="chat-body">'+n+"</div></div></div>":'<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.createTime+'</span><b>客服助手</b></div><div class="chat-body">'+n+"</div></div></div>"}$("#msg_box").prepend(t)}}function w(e){var t;switch(e.messageType){case"2":t=x(e.messages);break;case"10":t=T(e.messages);break;case"11":t=I(e.messages);break;case"12":t=k(e.messages);break;default:t=O(W.face.toEmoji(e.messages))}return t}function k(e){for(var t=JSON.parse(e),n='<div><div style="padding: 2px 0 8px 0; font-size: 13px;"><span>以下是最新物流信息：<span></div>',a=0;a<t.length;a++)n+="<div><span> "+t[a].lgtime+" </span></div><div><span> "+t[a].lgdesc+" </span></div>";return n+="</div>"}function T(e){var t=JSON.parse(e),n=0==Te?'<a href="'+t.wapUrl+'" target="_blank">'+t.name+"</a>":'<a href="'+t.pcUrl+'" target="_blank">'+t.name+"</a>";return n}function I(e){var t=JSON.parse(e);return'<div class="ordercard">\n                    <ul class="sendPrdUl">\n                        <li class="prdCodeLi">\n                            <div>\n                                <label style="padding-left: 8px;">订单号:</label>\n                                <span style="margin-left: -5px;">'.concat(t.orderCode,'</span><br>\n                                <label style="padding-left: 8px;">下单时间:</label>\n                                <span style="margin-left: -5px;">').concat(t.orderTime,'</span>\n                                <span style="float:right">\n                                    <b>').concat(t.orderStatusInfo,'</b>\n                                </span>\n                            </div>\n                        </li>\n                        <li class="prdLi">\n                            <div class="img">\n                                <img src="').concat(t.prdInfo.prdImgUrl,'" alt="">\n                            </div>\n                            <div class="prdLiDiv">\n                                <a href="').concat(t.prdInfo.prdDetailUrl,'" title="').concat(t.prdInfo.prdName,'" target="_blank" class="prdNameP">').concat(t.prdInfo.prdName,'</a>\n                                <p style="color: #999;">\n                                    <span>商品编号：</span>\n                                    <span style="margin-left: -0.5rem;">').concat(t.prdInfo.prdCode,'</span>\n                                </p>  \n                                <p class="prdInfoP">\n                                    <span>数量：</span>\n                                    <span style="padding-right: 8px; margin-left: -8px;">').concat(t.prdInfo.prdAcount,"</span>\n                                    <b>￥").concat(t.prdInfo.prdPrice,'</b>\n                                </p>\n                            </div>\n                        </li>\n                        <li class="prdAmountLi">\n                            <div style="position: relative">\n                                <span>共</span>\n                                <span style="margin-left: -4px;">').concat(t.orderAcount,'</span>\n                                <span style="padding-right: 8px; margin-left: -4px;">件</span>\n                                <span>订单金额：</span>\n                                <b style="color: #e2231a; margin-left: -12px;">￥').concat(t.orderAmount,"</b>\n                            </div>\n                        </li>\n                    </ul>\n                </div>").replace(/\n/gm,"")}function x(e){return'<img src="'+e+'" style="max-width: 100%; max-height: 300px;" onload="conFitScroll()"/>'}function E(e){$("#msg_box").append(e),j()}function S(e,t){var n;t&&((n=e.pid)&&(t='<div class="record" pid="'+n+'" >'+t+"</div>"),$("#msg_box").append(t)),j()}function j(){var e=$("#msg_box").height()-$("#chatDiv").height();0<e&&$("#chatDiv").scrollTop(40+e)}function O(e){return e.replace(/((((http?|https?):(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/gi,function(e){var t=e;return 4<e.length&&"http"!==e.substr(0,4)&&(e="//"+e),'<a class="custom-link" href="'+e+'" target="_blank">'+t+"</a>"})}function C(e){var t=[];str=str.replace(/(http(s)?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w\-\.\/?%&=]*)?/gi,function(e){return t.push(e),""}),str=str.replace(/(http(s)?:\/\/)?([\w-]+\.)+[\w-]+(\/[\w\-\.\/?%&=]*)?/g,function(e,t){return'<a class="custom-link" href="'+e+'" target="_blank">'+e+"</a>"}),str=str.replace(/\x01/g,function(e){return t.shift()})}g.buildChat=function(e){var t,n;switch(e.body.type){case"BUILDING_CHAT":h(e.body.content);break;case"WAITTING":h(u.waitting_tip.replace("{0}",e.body.content));break;case"SUCCESS":try{var a=JSON.parse(e.body.content);te.tmb=a.tmb,te.skn=a.skn}catch(e){}h(u.service_info.replace("{0}",e.from.uid));break;case"TEAM_GREET":case"WAITER_GREET":n=O(W.face.toEmoji(e.body.content)),t='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+n+"</div></div></div>"}S(e,t)},g.message=function(e){var t,n;switch(e.body.type){case"TEXT":t=p.filterHtmlJsSpaceEnter(e.body.content),n='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+O(W.face.toEmoji(t))+"</div></div></div>";break;case"TIMEOUT_TIP":n='<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>客服助手</b></div><div class="chat-body">'+W.face.toEmoji(e.body.content)+"</div></div></div>";break;case"TIMEOUT_CLOSE":n='<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>客服助手</b></div><div class="chat-body">'+W.face.toEmoji(e.body.content)+"</div></div></div>",h(u.close_tip);break;case"IMAGE":n='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+m.createImgHtml(e.body.content)+"</div></div></div>";break;case"LOGISTICS":n='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+k(e.body.content)+"</div></div></div>";break;case"GOODS":n='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+T(e.body.content)+"</div></div></div>";break;case"ORDER":n='<div class="service-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+e.datetime+"</span><b>"+(te.tmb||"")+'</b><b class="left-space">'+e.from.uid+'</b></div><div class="chat-body">'+I(e.body.content)+"</div></div></div>";break;case"TIP":case"ROBOT":n='<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>客服助手</b></div><div class="chat-body">'+W.face.toEmoji(e.body.content)+"</div></div></div>";break;default:n='<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>客服助手</b></div><div class="chat-body">'+W.face.toEmoji(e.body.content)+"</div></div></div>",h(u.close_tip)}S(e,n)},g.transfer=function(e){var t;if("SUCCESS"===e.body.type){h(u.service_info.replace("{0}",e.from.uid)),t='<div class="robot-chat clearfix"><div class="portrait icons"></div><div class="container"><div class="arrow icons"></div><div class="chat-head ell"><span>'+m.dateFormat()+'</span><b>客服助手</b></div><div class="chat-body">已为您转接客服工号：'+e.from.uid+"， 请输入您要咨询的问题。</div></div></div>";try{var n=JSON.parse(e.body.content);te.tmb=n.tmb,te.skn=n.skn}catch(e){}}S(e,t)},g.broadcast=function(e){"WAITTING_NO"===e.body.type&&h(u.waitting_tip.replace("{0}",e.body.content))};var A={first:!0},L={loadChatRecord:function(){var e={};A.id&&(e.id=A.id),A.more||o.jsonp(s.chatRecord,e,!0,function(e){if(0==e.rc){for(var t=e.data,n=t.length,a=0;a<n;a++)f.renderHistory(t[a]);A.first&&(A.first=!1,$("#load_chat_more").show(),$("#history_up").show()),A.id||f.toScroll(),0<n&&(A.id=t[n-1].id),n<10&&(A.more=!0,$(".load-chat-more").html("没有更多"))}})}},D=function(a){var i=a.customer;a.active=!1,o({type:"AUTH",ts:"POLLING",ttc:i.ttc,skc:i.skc,skn:i.skn,gc:i.gc,from:{idy:"CUSTOMER"},body:{type:"LOGIN"}},function(e){f.render(f.type.broadcast,u.build_success),function n(){var e={type:"POLL",ts:"POLLING",ttc:i.ttc,skc:i.skc,skn:i.skn,gc:i.gc,to:{idy:"WAITER"},from:{uid:i.cc,name:i.cn,idy:"CUSTOMER"},body:{type:"TEXT"}};$.ajax({type:"GET",url:a.url,data:{packet:JSON.stringify(e),t:(new Date).getTime()},dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(e&&e instanceof Array)for(var t=0;t<e.length;t++)f.render(f.type.inMessage,e[t]);a.active&&setTimeout(n(),1e3)},error:function(e){console.log("请求失败： "+e)}})}(),a.active=!0,t()});var t=function(){$(document).delegate("#message_area","keydown",function(e){if(e.ctrlKey||e.metaKey||e.altKey||$("#message-area").focus(),13===e.which){var t="";return""===(t=$("#message_area").val())?(l.showDialog({content:"消息不能为空"}),!1):(t&&300<t.length?l.showDialog({content:"消息不能超过300字"}):(t&&t.length<=300&&($("#message_area").val(""),t=p.filterHtmlJsSpaceEnter(t),1===Te?$("#message_area").focus():$("#message_area").blur(),s(t,"TEXT"),f.render(f.type.outMessage,{content:t,type:"TEXT"})),e.preventDefault()),!1)}}),$(document).delegate("#send_msg_btn","click",function(){var e="";return""===(e=$("#message_area").val())?l.showDialog({content:"消息不能为空"}):e&&300<e.length?l.showDialog({content:"消息不能超过300字"}):(e&&e.length<=300&&($("#message_area").val(""),e=p.filterHtmlJsSpaceEnter(e),1===Te?$("#message_area").focus():$("#message_area").blur(),s(e,"TEXT"),f.render(f.type.outMessage,{content:e,type:"TEXT"})),event.preventDefault()),!1})};function s(e,t){var n={type:"MESSAGE",ts:"POLLING",ttc:i.ttc,skc:i.skc,skn:i.skn,gc:i.gc,to:{idy:"WAITER"},from:{uid:i.cc,name:i.cn,idy:"CUSTOMER"},body:{type:t,content:e}};o(n,function(e){console.log("消息发送成功!"+JSON.stringify(n))})}function o(e,t,n){e&&(e.pid=m.getPid(),$.ajax({type:"GET",url:a.url,data:{packet:JSON.stringify(e),t:(new Date).getTime()},dataType:"json",xhrFields:{withCredentials:!0},success:function(e){t(e)},error:function(e){n&&n instanceof Function&&n(e),console.log("发送消息失败：{}",JSON.stringify(e))}}))}return{sendImg:function(e,t,n){s(t,n),f.render(f.type.outMessage,{content:e,type:"IMAGE"})},sendMsg:function(e,t){s(e,t),f.render(f.type.outMessage,{content:e,type:t})},close:function(){opt.active=!1,o({type:"CLOSE",ts:"POLLING",ttc:i.ttc,skc:i.skc,skn:i.skn,gc:i.gc,to:{idy:"WAITER"},from:{uid:i.cc,name:i.cn,idy:"CUSTOMER"}},function(e){console.log("关闭!")})}}},M=function(t){var n,a,i=t.customer,s=!1,o=!0;function e(){var e=t.url+"?packet="+JSON.stringify({type:"AUTH",ts:"WEBSOCKET",from:{idy:"CUSTOMER"},body:{type:"LOGIN"}})+"&t="+(new Date).getTime();(a=new WebSocket(e)).onopen=function(){s=!1,f.render(f.type.broadcast,u.build_success),clearInterval(n),n=setInterval(function(){r({type:"PING",ts:"WEBSOCKET",body:{type:"TEXT",content:"PING"}})},3e4)},a.onmessage=function(e){"RE_LOGIN"==(e=JSON.parse(e.data)).type?(o=!0,clearInterval(n),f.renderBroadcast("已在其他打开咨询，当前会话被关闭")):f.render(f.type.inMessage,e)},a.onerror=function(e){s=!0,f.render(f.type.broadcast,"糟糕，网络错误，工程师正在维护中...")},a.onclose=function(){o||(s||f.render(f.type.broadcast,"糟糕，网络连接断开"),d())},$(document).delegate("#message_area","keydown",function(e){if(e.ctrlKey||e.metaKey||e.altKey||$("#message-area").focus(),13===e.which)return $("#send_msg_btn").click(),e.preventDefault(),!1}),$("#send_msg_btn").on("click",function(){var e=$("#message_area").val();return""===e?l.showDialog({content:"消息不能为空"}):e&&300<e.length?l.showDialog({content:"消息不能超过300字"}):(e&&e.length<=300&&($("#message_area").val(""),e=p.filterHtmlJsSpaceEnter(e),1===Te?$("#message_area").focus():$("#message_area").blur(),c(e,"TEXT"),f.render(f.type.outMessage,{content:e,type:"TEXT"})),event.preventDefault()),!1})}function c(e,t){r({type:"MESSAGE",ts:"WEBSOCKET",from:{uid:i.cc,name:i.cn,idy:"CUSTOMER"},body:{type:t,content:e}})}function r(e){e&&(1===a.readyState?(e.pid=m.getPid(),e.to={idy:"WAITER"},a.send(JSON.stringify(e))):d())}function d(){3===a.readyState&&(clearInterval(n),setTimeout(e,5e3))}return e(),{sendImg:function(e,t,n){c(t,n),f.render(f.type.outMessage,{content:e,type:"IMAGE"})},sendMsg:function(e,t){c(e,t),f.render(f.type.outMessage,{content:e,type:t})},close:function(){1==a.readyState&&a.close()}}},R=U(),N={};function U(){$(".p-view").on("click","img",function(e){P(this)})}function P(e){var t=$(window).width(),n=$(window).height(),a=e.naturalWidth,i=e.naturalHeight;t<a&&(a=t,i-=parseInt(a/i*(a-t))),n<i&&(i=n,a-=parseInt(i/a*(i-n))),N.src=e.src,N.rotate=0,N.change=!1,N.scale=100,N.height=i,N.width=a,N.top=parseInt(n/2-N.height/2),N.left=parseInt(t/2-N.width/2);var s='<div id="p_img_container" style="left:'+N.left+"px; top: "+N.top+'px;">',o='<img id="p_img" src="'+N.src+'" style="width: '+N.width+'px;" />';$("#p_img_mask_wrapper").remove();var c='<div id="p_img_mask_wrapper"><div id="p-view-close-container"><div id="p-view-close"></div></div>'+s+o+'</div><div id="p_img_tip"></div><div id="p_img_opts"><span id="p_img_plus_btn" title="放大"></span><span id="p_img_minus_btn" title="缩小"></span><span id="p_img_rotate_btn" title="旋转"></span><span id="p_img_reset_btn" title="重置"></span></div></div>';$("body").append(c),F()}function F(){$("#p_img_mask_wrapper").unbind("click").bind("click",function(){m.stopPropagation(event),$("#p_img_mask_wrapper").remove(),N={}}),$("#p_img_container").unbind("click").bind("click",function(){m.stopPropagation(event)}),$("#p_img_plus_btn").unbind("click").bind("click",function(){var e;m.stopPropagation(event),N.scale+=10,260<=N.scale?(N.scale=260,$("#p_img_tip").html("已经是最大比例"+N.scale+"%").finish().fadeIn().delay(1500).fadeOut()):(e=N.scale/100,$("#p_img_tip").html(N.scale+"%").finish().fadeIn().delay(1500).fadeOut(),$("#p_img").width(N.width*e)),N.change||H()}),$("#p_img_minus_btn").unbind("click").bind("click",function(){var e;m.stopPropagation(event),N.scale-=10,N.scale<=0?(N.scale=10,$("#p_img_tip").html("已是最小比例"+N.scale+"%").finish().fadeIn().delay(1500).fadeOut()):(e=N.scale/100,$("#p_img_tip").html(N.scale+"%").finish().fadeIn().delay(1500).fadeOut(),$("#p_img").width(N.width*e)),N.change||H()}),$("#p_img_rotate_btn").unbind("click").bind("click",function(){m.stopPropagation(event),N.rotate=N.rotate+90,360<N.rotate&&(N.rotate=90),$("#p_img_tip").html("旋转"+N.rotate+"度").finish().fadeIn().delay(1500).fadeOut(),$("#p_img").css("transform","rotate("+N.rotate+"deg)")}),$("#p_img_reset_btn").unbind("click").bind("click",function(e){m.stopPropagation(e),$("#p_img_tip").html("重置").finish().fadeIn().delay(1500).fadeOut(),$("#p_img").width(N.width),$("#p_img").css("transform","rotate(0deg)"),H(),N.scale=100,N.change=!1});var i=$("#p_img_container");i.bind("mousedown",function(e){var t,n,a;return m.stopPropagation(e),0==e.button&&($("#p_img_opts").hide(),t=i.offset(),n=e.pageX-t.left,a=e.pageY-t.top,i.unbind("mousemove").bind("mousemove",function(e){return N.change=!0,i.css("left",e.pageX-n+"px"),i.css("top",e.pageY-a+"px"),!1}),i.unbind("mouseup").bind("mouseup",function(){i.unbind("mousemove"),$("#p_img_opts").show()})),!1})}function H(){var e=$(window).width(),t=$(window).height(),n=$("#p_img").width(),a=$("#p_img").height();$("#p_img_container").css({left:e/2-n/2+"px",top:t/2-a/2})}var G={em:void 0,toEmoji:void 0,show:void 0,hide:void 0},W={face:Y()};function J(e,a){var t;$(e).append('<div class="emoji-inner"><ul class="emoji-nav"></ul><div class="emoji-content"></div></div>'),a.showbar?(t=_.reduce(a.category,function(e,t){var n=_.find(a.data,function(e){return e.typ==t});return e+'<li data-name="'+t+'">'+n.nm+"</li>"},""),$(e).find(".emoji-nav").empty().append(t)):$(e).addClass("no-bar")}function B(e,n,t){var a=(a=_.find(n.data,function(e){return e.typ==t}))||n.data[0],i=_.reduce(a.items,function(e,t){return t?e+'<img title="'+t.name+'" src="'+n.path+t.src+'" data-name="'+t.name+'" data-src="'+n.path+t.src+'">':e},"");$(e).find(".emoji-content").empty().append(i),$(e).find(".emoji-nav li[data-name="+a.typ+"]").addClass("on").siblings().removeClass("on")}function X(e,t){$(e).on(t.trigger,".emoji-nav > li",function(){return B(e,t,$(this).attr("data-name")),!1}),$(e).on("click",".emoji-content > img",function(){t.insertAfter({name:$(this).attr("data-name"),src:$(this).attr("data-src")})})}function K(e,t){$(e).on("click",".emoji-tbtn",function(){return $(e).find(".emoji-inner").toggle(),!1}),$(document).click(function(){$(e).hide(),$(e).find(".emoji-inner").hide()})}function q(e){var t=$("#emoji_container"),n=$.extend({},V(),e||{});return G.hide=function(){t.hide(),t.find(".emoji-inner").hide()},G.show=function(){t.show(),t.find(".emoji-inner").show()},t.each(function(){return!(0<!t.find(".val").length)&&(J(t,n),B(t,n),X(t,n),void K(t,n))})}function z(e,t){var n,a,i,s,o,c,r=$("#message_area"),d=r[0];window.getSelection?(n=d.selectionStart,a=d.selectionEnd,i=d.scrollTop,d.value=d.value.substring(0,n)+e+d.value.substring(a,d.value.length),r.focus(),d.selectionStart=n+e.length,d.selectionEnd=n+e.length,d.scrollTop=i,2==arguments.length&&(d.setSelectionRange(n-t,d.selectionEnd+t),r.focus())):document.selection?(r.focus(),(s=document.selection.createRange()).text=e,r.focus(),s.moveStart("character",-c),o=s.text.length,2==arguments.length&&(c=d.value.length,s.moveEnd("character",o+t),t<=0?s.moveStart("character",o-2*t-e.length):s.moveStart("character",o-t-e.length),s.select())):(r.value+=e,r.focus()),$("#input-add-field").hide(),$("#send_msg_btn").show()}function Y(){var a={insertAfter:function(e){z("[:"+e.name+":]")},path:"images/"};q(a);var i=Q();return G.toEmoji=function(e){var t=[];_.each(i,function(e){null!==e&&t.push(e.name)});var n=new RegExp("\\[:("+(1<t.length?t.join("|"):t+"")+"):\\]","g");return e.replace(n,function(t){t=t.replace("[:","").replace(":]","");var e=_.filter(i,function(e){return null!=e&&e.name==t});return'<img name="[:'+t+':]" src="'+a.path+e[0].src+'" alt="'+t+'" style="width: 25px;height: 25px;cursor: pointer;vertical-align: middle;"/>'})},G}function Q(t){for(var e=t?this.data=_.filter(V().data,function(e){return _.contains(t,e.typ)}):V().data,n=0,a=e.length,i=[];n<a;n++)for(var s=e[n].items,o=0,c=s.length;o<c;o++)i.push(s[o]);return i}function V(){return{data:[{typ:"EmojiCategory-People",nm:"人物",items:[{name:"笑脸",src:"face/笑脸.png"},{name:"开心",src:"face/开心.png"},{name:"大笑",src:"face/大笑.png"},{name:"爱心",src:"face/爱心.png"},{name:"飞吻",src:"face/飞吻.png"},{name:"调皮",src:"face/调皮.png"},{name:"讨厌",src:"face/讨厌.png"},{name:"笑哭",src:"face/笑哭.png"},{name:"流泪",src:"face/流泪.png"},{name:"坏笑",src:"face/坏笑.png"},{name:"流汗",src:"face/流汗.png"},{name:"汗颜",src:"face/汗颜.png"},{name:"尴尬",src:"face/尴尬.png"},{name:"流泪",src:"face/流泪.png"},{name:"冷酷",src:"face/冷酷.png"},{name:"惊恐",src:"face/惊恐.png"},{name:"惊悚",src:"face/惊悚.png"},{name:"惊讶",src:"face/惊讶.png"},{name:"大惊",src:"face/大惊.png"},{name:"大闹",src:"face/大闹.png"},{name:"发呆",src:"face/发呆.png"},{name:"犯困",src:"face/犯困.png"},{name:"心碎",src:"face/心碎.png"},{name:"酷",src:"face/酷.png"},{name:"生气",src:"face/生气.png"},{name:"闭嘴",src:"face/闭嘴.png"},{name:"睡着",src:"face/睡着.png"},{name:"奋斗",src:"face/奋斗.png"},{name:"愤怒",src:"face/愤怒.png"},{name:"瞌睡",src:"face/瞌睡.png"},{name:"难过",src:"face/难过.png"},{name:"天使",src:"face/天使.png"},{name:"无聊",src:"face/无聊.png"},{name:"骂人",src:"face/骂人.png"},{name:"点赞",src:"face/点赞.png"},{name:"懵逼",src:"face/懵逼.png"},{name:"白眼",src:"face/白眼.png"},{name:"恶魔",src:"face/恶魔.png"},{name:"感冒",src:"face/感冒.png"},{name:"爱你",src:"face/爱你.png"},{name:"呕吐",src:"face/呕吐.png"},{name:"呲牙",src:"face/呲牙.png"}]}],path:"images/",category:["EmojiCategory-People"],showbar:!0,trigger:"click",insertAfter:function(){}}}var Z,ee,te,ne,ae={},ie={startChat:function(){me(),fe(),pe(),_e()}},se=[],oe=1,ce=!1,re=null;function de(e){$(".s-tips").html(e),$(".m-sbt-suc").show(),Z&&clearTimeout(Z),Z=setTimeout(function(){$(".s-tips").html(""),$(".m-sbt-suc").hide()},1500)}function le(){$("#option_box").hide(),$(".chat-menu-footer").hide(),$("#inner_sug").val(""),$(".ay-star-ul li").css("background-image","url('/images/chatwap/ic.png')")}function pe(){$(document).click(function(e){"footerActionBar"!==e.target.id&&($("#emoji_container").hide(),$("#emoji_container").find(".emoji-inner").hide(),$(".chat-menu-footer").hide())}),$("#footerActionBar").on("click",function(e){m.stopPropagation(event),$("#emoji_container").is(":visible")&&$("#emoji_container").show(),$(".chat-menu-footer").is(":visible")&&$(".chat-menu-footer").show()}),$(".click-emoji").on("click",function(){$("#emoji_container").toggle(),$("#emoji_container .emoji-inner").show(),$(".chat-menu-footer").hide()}),$("#input-add-field").on("click",function(){$(".chat-menu-footer").toggle(),$("#emoji_container").hide()}),$("#click-star").on("click",function(){return te.cid==ae.chatId?(de("已评价！"),!1):te.cid?($("#option_box").show(),void $(".chat-menu-footer").hide()):(de("请咨询后再评价！"),!1)}),$(".ay-star-ul li").unbind("click").bind("click",function(){var e=$(this).index();ae.opinion=e+1,$(".ay-star-ul").find("li").css("background-image","url('/images/chatwap/ic.png')");for(var t=0;t<=e;t++)e<3?$(".textarea-div").css({display:"block"}):$(".textarea-div").css({display:"none"}),$(".ay-star-ul").find("li").eq(t).css("background-image","url('/images/chatwap/iced.png')")}),$(".ay-ms-cut").on("click",function(e){le()}),$("#submit_sug").on("click",function(){return te.cid==ae.chatId?(de("已评价！"),le(),!1):te.cid?(ae.suggest=$("#inner_sug").val(),ae.chatId=te.cid,ae.opinion&&(ae.suggest||!ae.opinion||"1"!=ae.opinion&&"2"!=ae.opinion)?ae.opinion&&("1"==ae.opinion||"2"==ae.opinion)&&$.trim(ae.suggest).length<10?(de("请填写您的建议且建议内容至少10个字!"),$("#inner_sug").focus(),!1):($.trim(ae.suggest)&&(ae.suggest=p.filterHtmlJsSpaceEnter(ae.suggest)),void(ae.chatId&&ae.opinion?o.jsonp(s.opinion,ae,!0,function(e){return e&&0==e.rc?(ae.opinion=void 0,void de("评价成功！")):(de(e.rm),le(),!1)}):de("请完善评价信息！"))):(de("请选择或者输入建议！"),!1)):(de("请咨询后再评价！"),le(),!1)}),$("#message_area").focus(function(e){$("#emoji_container").is(":visible")&&$("#emoji_container").show(),$(".chat-menu-footer").is(":visible")&&$(".chat-menu-footer").show(),$(".chat-menu-footer").hide(),$("#emoji_container").hide(),$("#message_area").val()?($("#input-add-field").hide(),$("#send_msg_btn").show()):($("#send_msg_btn").hide(),$("#input-add-field").show())}),$("#message_area").blur(function(){$("#message_area").val()?($("#input-add-field").hide(),$("#send_msg_btn").show()):($("#send_msg_btn").hide(),$("#input-add-field").show())}),$("#message_area").on("keyup",function(){$("#message_area").val()?($("#input-add-field").hide(),$("#send_msg_btn").show()):($("#send_msg_btn").hide(),$("#input-add-field").show())}),$("#set-file").unbind("click").bind("click",function(){return $("#upload_file").click(),!1}),$(document).delegate("#upload_file","change",function(){var e=$(this);if(!(e.val().length<1)){var t=e[0].files[0];if(t){if(-1==t.type.indexOf("image/"))return void l.showDialog({content:"请上传图片"});if(6291456<t.size.toFixed(2))return void l.showDialog({content:"请上传小于6M的图片"});EXIF.getData(t,function(){EXIF.getAllTags(this),Orientation=EXIF.getTag(this,"Orientation")});var n=new FileReader;n.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){var e=this.naturalWidth,t=this.naturalHeight;this.naturalWidth>this.naturalHeight&&800<this.naturalWidth?t=(e=800)*this.naturalHeight/this.naturalWidth:this.naturalHeight>this.naturalWidth&&1200<this.naturalHeight&&(e=(t=1200)*this.naturalWidth/this.naturalHeight);var n=document.createElement("canvas"),a=n.getContext("2d");n.width=e,n.height=t,a.drawImage(this,0,0,e,t);var i=n.toDataURL("image/jpeg",.8);m.uploadImgB64(s.uploadImgb64,i,function(e){var t;0==e.rc?(t=m.createImgHtml(e.imgurl,!1),ne.sendImg(t,e.imgurl,"IMAGE")):de(e.msg),$("#set-file").data("isUploading",!1),$("#upload_file").after($("#upload_file").clone().val("")).remove()})}},n.readAsDataURL(t)}}}),$(".marks_info .mark_order").on("click",function(e){$(".marks_info").parents(".app-main").siblings(".myorder").show(),$(".marks_info").parents(".app-main").css("opacity","0.1")}),$(".myorder .close_myorder").on("click",function(e){$(".marks_info").parents(".app-main").siblings(".myorder").hide(),$(".marks_info").parents(".app-main").css("opacity","1")}),$(".myorder_main").on("click","ul li .send-order",function(e){var t=$(this).parent().parent().parent().parent().index(),n=$(this).attr("data-index"),a=se[t],i=se[t].prdInfoList[n],s={orderCode:a.orderId,orderTime:a.orderTime,orderAmount:a.orderAmount,orderStatusInfo:a.orderStatusInfo,prdInfo:{prdImgUrl:i.prdImgUrl,prdName:i.prdName,prdAcount:i.prdAcount,prdPrice:i.prdPrice,prdDetailUrl:i.prdDetailUrl,prdCode:i.prdCode},orderAcount:a.prdInfoList.length};ne.sendMsg(JSON.stringify(s),"ORDER"),$(".marks_info").parents(".app-main").siblings(".myorder").hide(),$(".marks_info").parents(".app-main").css("opacity","1")}),$(".myorder_main").on("click","ul li .view",function(e){var t=$(this).parents().parents().index(),n=se[t];$(this).hasClass("active")?$(this).removeClass("active").parents().siblings(".logisticsList").hide():($(this).addClass("active").parents().siblings(".logisticsList").show(),$(this).parents().parents().siblings().children(".logisticsList").hide(),we(n))})}function ue(){te&&1==te.real?(L.loadChatRecord(),$("#load_chat_more").bind("click",function(){L.loadChatRecord()})):($(".load-chat-more").hide(),$(".history-up").hide())}function me(){var e=m.getUrlParams().gc;e&&o.jsonp(s.goodsDetail,{gc:e,plat:1},!1,function(e){var t;if(0==e.rc&&(e.data&&(t=JSON.parse(e.data),console.log(e.data,295)),t&&t.items&&0<t.items.length))return void he(t.items[0])})}function fe(){o.jsonp(s.recommendList,{},!0,function(e){var t;0==e.rc&&(!e.data||0<(t=ge(e.data)).length&&($("#mark_list").html(t),$("div.marks_info").show()))})}function ge(e){var t=[];if(e&&0<e.length)for(var n,a=0;a<e.length;a++)(n=e[a])&&t.push("<a href='"+(n.recoUrl?n.recoUrl:"javascript://;")+"' target='_blank'>"+(n.recoName?n.recoName:"")+"</a>");return t.join("")}function ve(e){e.blur(),e.focus();var t,n=e.value.length;document.selection?((t=e.createTextRange()).moveStart("character",n),t.collapse(),t.select()):e.selectionStart=e.selectionEnd=n}function he(e){var t=m.isMobile()?e.wapDetailUrl:e.pcDetailUrl,n=e.path&&"/"===e.path.charAt(0)?"https://p1.lefile.cn"+e.path:"https://p1.lefile.cn/"+e.path,a='<div class="goods-info"><div class="goods-container"><div class="goods-img"><img id="goods_pic" src="'+n+'" style="width: 40px;"></div><div class="goods-name"><span>'+e.name+'</span></div></div><div class="goods-line"></div><div class="goods-send-url" data-url="'+t+'"> <span>发送地址</span> </div></div>';f.renderHtml(a),$(".goods-send-url").unbind().bind("click",function(){var e=$(".goods-send-url").attr("data-url");e&&ne.sendMsg(e,"TEXT")})}function be(e,t){for(var n="",a=0;a<t;a++){n+='<ul>\n                    <li class="orderLi">\n                        <div style="display: inline-block;">\n                            <label>订单号:</label>\n                            <span>'.concat(e[a].orderId," </span>\n                            <span>").concat(e[a].orderTime," </span>\n                        </div>\n                        <span>\n                            <b>").concat(e[a].orderStatusInfo," </b>\n                        </span>\n                    </li>").replace(/\n/gm,"");for(var i=0;i<e[a].prdInfoList.length;i++)if(n+='<li class="prdLi">\n                        <div style="display: flex; width: 100%;">\n                            <div class="img">\n                                <img src="'.concat(e[a].prdInfoList[i].prdImgUrl,' " alt=""/>\n                            </div>\n                            <div class="myorder_content">\n                                <a href="').concat(e[a].prdInfoList[i].prdDetailUrl,'" target="_blank" class="myorder_content_name">\n                                    ').concat(e[a].prdInfoList[i].prdName,' \n                                </a>\n                                <p style="color: #999;">\n                                    <span>商品编号：</span>\n                                    <span style="margin-left: -0.5rem;">').concat(e[a].prdInfoList[i].prdCode,' </span>\n                                </p>   \n                                <p style="color: #999;">\n                                    <span>数量：</span>\n                                    <span style="margin-left: -0.5rem;">').concat(e[a].prdInfoList[i].prdAcount,' </span>\n                                    <b style="color: #000;">￥').concat(e[a].prdInfoList[i].prdPrice,' </b>\n                                </p>\n                                <button class="send-order" data-index="').concat(i,'">发送</button>\n                            </div>\n                        </div>\n                    </li> ').replace(/\n/gm,""),e[a].prdInfoList[i].additional)for(var s=0;s<e[a].prdInfoList[i].additional.length;s++)n+='<li class="prdLi">\n                                <div style="display: flex; width: 100%;">\n                                    <img class="img" src="'.concat(e[a].prdInfoList[i].additional[s].prdImgUrl,'" alt="">\n                                    <div class="myorder_content">\n                                        <p class="myorder_content_name">\n                                            <b style="color:#e2231a;">').concat("1"===e[a].prdInfoList[i].additional[s].isGift?"【赠品】":"0"===e[a].prdInfoList[i].additional[s].isService?"":"【服务】","</b>").concat(e[a].prdInfoList[i].additional[s].prdName,'\n                                        </p>\n                                        <p style="color: #959595;">\n                                            <span>数量：</span>\n                                            <span style="margin-left: -8px;">').concat(e[a].prdInfoList[i].additional[s].prdAcount,'</span>\n                                        </p>\n                                        <p style="display: ').concat("1"===e[a].prdInfoList[i].additional[s].isGift?"none":"inline-block",';"><b>￥').concat(e[a].prdInfoList[i].additional[s].prdPrice,"</b></p>\n                                    </div>\n                                </div>\n                            </li> ").replace(/\n/gm,"");n+='<li class="prdlenLi">\n                    <div style="display: inline-block;">\n                        <span>共</span><span>'.concat(e[a].prdInfoList.length,'</span><span style="padding-right: 12px;">件</span>\n                        <span>订单金额：</span><span style="color: #f4364c; margin-left: -8px"><b>￥').concat(e[a].orderAmount,'</b></span>\n                    </div>\n                </li>\n                <li style="justify-content: center;">\n                    <button class="view" data-index="').concat(a,'">\n                        <lable>查看物流</lable>\n                        <img src="./images/chatwap/down-arrow.png">\n                    </button>\n                </li>\n                <li style="display:none" class="logisticsList"></li>\n            </ul>').replace(/\n/gm,"")}n+='<ul class="loading"><p>疯狂加载中...</p></ul><ul class="loading_end"><p>亲，没有更多了~</p></ul>',$(".myorder_main").html(n)}function _e(t){var e=m.getUrlParams(),n={ttc:e.ttc?e.ttc:1,pageNum:oe,pageSize:3};oe++,o.jsonp(s.orderList,n,!0,function(e){0==e.rc?e.data?($(".myorder_nall").hide(),be(se=se.concat(e.data),se.length),$(".myorder_main").on("scroll",ke),1===t?$(".loading").hide():$(".loading").show()):($(".myorder_nall").show(),$(".loading").hide(),$(".loading_end").show(),setTimeout(function(){$(".loading_end").hide()},600),$(".myorder_main").off("scroll",ke)):$(".myorder_main").off("scroll",ke)})}function ye(e,a){var t='<div class="package-status"><div class="status-box">\n        <ul class="status-list" id="status-list">\n        <div style="display: list-item;"><div class="status-content-latest">'.concat(a.deliveryAddress.address,"</div></div>");t+=e.data.logistics0.map(function(e,t,n){return'<li class="test '.concat(0===t&&"9"===a.orderStatus?"endact":""," ").concat(t===n.length-1?"firstact":"",'" style="display:block">\n             <div class="status-content-before">').concat(e.lgdesc,'</div>\n             <div class="status-time-before">').concat(e.lgtime,"</div>\n        </li>")}).join(""),t+="</ul></div></div>",$(".logisticsList").html(t)}function $e(e){$(".logisticsList").html('<div class="package-status"><div class="status-box">\n        <ul class="status-list" id="status-list">暂无物流信息</ul></div></div>')}function we(t){var e=m.getUrlParams(),n={ttc:e.ttc?e.ttc:1,orderCode:t.orderId};o.jsonp(s.logistics,n,!0,function(e){0==e.rc?ye(e,t):$e(e)})}function ke(){$(".loading").show(),$(this)[0].scrollTop+$(this).height()>=$(this)[0].scrollHeight&&(clearTimeout(re),re=setTimeout(function(){_e(1),ce=!0},800))}var Te=2,Ie=!!window.WebSocket;function xe(){var e=m.getUrlParams(),i={ttc:e.ttc?e.ttc:1,skc:e.skc,buc:e.buc,gc:e.gc,device:Te,origin:1,io:Ie?"ws":"poll"};o.jsonp(s.auth,i,!1,function(e){switch(e.rc){case 0:Ee(te=e.data),ue(),ie.startChat(),"1"===te.real?$(".mark_order").css("display","inline-block"):$(".mark_order").css("display","none"),e.skn&&-1!==e.skn.indexOf("EFF")&&(i.ttc=3);break;case 1:var t=encodeURIComponent(window.location.href);e.data&&e.data.loginUrl?window.open(e.data.loginUrl+"&ru="+t,"_self"):l.showDialog({content:e.rm});break;case 2:var n="",n=e.data&&e.data.offlineMsg?e.data.offlineMsg:e.rm;l.showDialog({content:n}),$("#chat_service_status_msg").text("客服非工作时间！"),ue();break;case 3:var a=window.location.host;window.location.href="//"+a;break;case 5:$(".app-main").hide(),l.showDialog({content:"由于在咨询过程中，咨询内容包含不合法信息，已暂时限制咨询请求！"});break;default:l.showDialog({content:"初始化信息失败，请重试！"})}},function(e){l.showDialog({content:"初始化信息失败，请重试！"})})}function Ee(e){ne=Ie?M({url:t.ws+"/ws.io",customer:e}):D({url:t.poll+"/poll.io",customer:e})}$(function(){document.domain=t.domain,xe()});